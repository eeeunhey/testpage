<!doctype html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MindDiary AI - ë‹¨ê³„ ì§„í–‰ ëª¨ë“œ í† ê¸€</title>
    <style>
        :root {
            --bg: #f8e6ea;
            --card: #fff;
            --text: #222;
            --muted: #6b6b6b;
            --border: #e9e9e9;
            --pink: #ff6f86;
            --pink2: #ff7b93;
            --soft: #fff6f8;
            --shadow: 0 12px 30px rgba(0, 0, 0, .08);
        }

        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, "Pretendard", "Noto Sans KR", sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 40px 16px;
            color: var(--text);
        }

        .wrap {
            width: min(980px, 100%)
        }

        .card {
            background: var(--card);
            border-radius: 22px;
            padding: 28px;
            box-shadow: var(--shadow);
        }

        h1 {
            margin: 0 0 6px;
            font-size: 24px;
            font-weight: 900;
            letter-spacing: -.3px;
            text-align: center;
        }

        .sub {
            margin: 0 0 18px;
            text-align: center;
            color: var(--muted);
            font-size: 13px;
            line-height: 1.5;
        }

        .title {
            margin: 22px 0 10px;
            font-weight: 900;
            font-size: 15px
        }

        .hint {
            margin: 0 0 12px;
            color: var(--muted);
            font-size: 13px;
            line-height: 1.5
        }

        textarea {
            width: 100%;
            min-height: 140px;
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 12px;
            font-size: 14px;
            outline: none;
            background: #fff;
        }

        textarea:focus {
            border-color: rgba(255, 111, 134, .7);
            box-shadow: 0 0 0 4px rgba(255, 111, 134, .12);
        }

        .actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
            margin-top: 14px;
        }

        .btn {
            height: 44px;
            padding: 0 14px;
            border-radius: 12px;
            font-weight: 900;
            border: 1px solid transparent;
            cursor: pointer;
            transition: transform .08s ease, box-shadow .15s ease, background .15s ease;
            user-select: none;
        }

        .btn:active {
            transform: translateY(1px)
        }

        .primary {
            background: linear-gradient(90deg, var(--pink), var(--pink2));
            color: #fff;
            box-shadow: 0 10px 20px rgba(255, 111, 134, .25);
        }

        .ghost {
            background: #fff;
            border-color: var(--border);
            color: #333;
        }

        /* âœ… ëª¨ë“œ í† ê¸€ ë°” */
        .modeBar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            margin-top: 14px;
            padding: 12px 14px;
            border: 1px solid rgba(0, 0, 0, .08);
            border-radius: 16px;
            background: #fff;
        }

        .modeLeft {
            min-width: 0;
        }

        .modeTitle {
            font-weight: 900;
            font-size: 13px;
            margin: 0 0 3px;
        }

        .modeDesc {
            margin: 0;
            color: var(--muted);
            font-size: 12px;
            line-height: 1.35;
        }

        .switch {
            flex: 0 0 auto;
            display: flex;
            align-items: center;
            gap: 10px;
            user-select: none;
        }

        .switchLabel {
            font-size: 12px;
            font-weight: 900;
            color: #444;
            white-space: nowrap;
        }

        .toggle {
            width: 52px;
            height: 30px;
            border-radius: 999px;
            border: 1px solid rgba(0, 0, 0, .12);
            background: #fff;
            padding: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: background .15s ease, border-color .15s ease;
        }

        .knob {
            width: 24px;
            height: 24px;
            border-radius: 999px;
            background: linear-gradient(90deg, var(--pink), var(--pink2));
            transform: translateX(0);
            transition: transform .18s ease;
            box-shadow: 0 8px 16px rgba(255, 111, 134, .25);
        }

        .toggle.on {
            background: rgba(255, 111, 134, .08);
            border-color: rgba(255, 111, 134, .35);
        }

        .toggle.on .knob {
            transform: translateX(22px);
        }

        /* íë¦„ */
        .flow {
            margin-top: 18px;
            border-top: 1px dashed rgba(0, 0, 0, .08);
            padding-top: 18px;
        }

        .step {
            margin-top: 14px;
            border: 1px solid rgba(0, 0, 0, .08);
            border-radius: 18px;
            background: #fff;
            overflow: hidden;
        }

        .step[hidden] {
            display: none !important;
        }

        .stepHead {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            padding: 14px;
            background: rgba(255, 111, 134, .06);
            border-bottom: 1px solid rgba(255, 111, 134, .18);
        }

        .stepHeadLeft {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 0;
        }

        .badge {
            flex: 0 0 auto;
            font-size: 12px;
            font-weight: 900;
            color: #ff4f6e;
            padding: 6px 10px;
            border-radius: 999px;
            background: #fff;
            border: 1px solid rgba(255, 111, 134, .25);
        }

        .stepTitle {
            font-weight: 900;
            font-size: 13px;
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .stepMeta {
            font-size: 12px;
            color: var(--muted);
            margin-top: 3px;
            line-height: 1.4;
        }

        .stepToggle {
            flex: 0 0 auto;
            border: 1px solid rgba(0, 0, 0, .12);
            background: #fff;
            padding: 8px 12px;
            border-radius: 999px;
            font-weight: 900;
            cursor: pointer;
        }

        .stepBody {
            padding: 14px
        }

        /* ì§ˆë¬¸/íŒíŠ¸ */
        .aiQuestion {
            margin: 0 0 10px;
            padding: 12px;
            border-radius: 14px;
            border: 1px dashed rgba(255, 111, 134, .45);
            background: var(--soft);
            font-size: 13px;
            line-height: 1.55;
        }

        .aiQuestion b {
            color: #ff4f6e
        }

        /* í•„ë“œ */
        .grid2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        @media (max-width: 860px) {
            .grid2 {
                grid-template-columns: 1fr
            }
        }

        .field {
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 12px;
            background: #fff;
            margin-top: 10px;
        }

        .labelRow {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 8px;
        }

        .label {
            font-weight: 900;
            font-size: 13px
        }

        .miniHint {
            color: var(--muted);
            font-size: 12px;
            line-height: 1.4;
            text-align: right;
        }

        .input {
            width: 100%;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 10px 10px;
            font-size: 13px;
            outline: none;
            background: #fff;
        }

        .input:focus {
            border-color: rgba(255, 111, 134, .7);
            box-shadow: 0 0 0 4px rgba(255, 111, 134, .12);
        }

        .candidatePanel {
            margin-top: 10px;
            border: 1px solid rgba(255, 111, 134, .22);
            background: rgba(255, 111, 134, .06);
            border-radius: 14px;
            padding: 10px;
        }

        .candidateTop {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            margin-bottom: 8px;
        }

        .candidateTop strong {
            font-size: 12px
        }

        .candidateTop small {
            font-size: 12px;
            color: var(--muted)
        }

        .chips {
            display: flex;
            flex-wrap: wrap;
            gap: 6px
        }

        .chip {
            font-size: 12px;
            padding: 7px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            background: #fff;
            cursor: pointer;
            user-select: none;
        }

        .chip:hover {
            background: #fafafa
        }

        .addRow {
            margin-top: 10px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }

        .addRow input {
            flex: 1 1 220px;
            min-width: 180px
        }

        .smallBtn {
            height: 38px;
            padding: 0 12px;
            border-radius: 12px;
            font-weight: 900;
            border: 1px solid rgba(0, 0, 0, .12);
            background: #fff;
            cursor: pointer;
        }

        .smallBtn:hover {
            background: #fafafa
        }

        /* âœ… ë‹¤ìŒ ë²„íŠ¼ */
        .nextBar {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 14px;
            flex-wrap: wrap;
        }

        .warn {
            margin-top: 10px;
            font-size: 12px;
            color: #b54556;
            background: rgba(255, 111, 134, .10);
            border: 1px solid rgba(255, 111, 134, .22);
            padding: 10px 12px;
            border-radius: 12px;
            display: none;
            line-height: 1.45;
            font-weight: 800;
        }

        .warn.show {
            display: block;
        }

        /* =============================
       âœ… ê²°ê³¼ ì¹´ë“œ UI
       ============================= */
        .finalWrap {
            margin-top: 14px;
            border-radius: 18px;
            background: #fff;
            border: 1px solid rgba(0, 0, 0, .06);
            padding: 14px;
            box-shadow: 0 10px 24px rgba(0, 0, 0, .06);
        }

        .finalList {
            display: grid;
            gap: 12px;
        }

        .finalCard {
            border: 1px solid rgba(0, 0, 0, .10);
            border-radius: 18px;
            background: #fff;
            padding: 14px;
        }

        .finalHead {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 900;
            color: #3a3a3a;
            margin-bottom: 10px;
        }

        .iconBox {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
            border: 1px solid rgba(0, 0, 0, .12);
            background: #fff;
        }

        .finalBody {
            color: #222;
            font-size: 14px;
            line-height: 1.7;
            min-height: 26px;
            padding-left: 2px;
        }

        .placeholder {
            color: #8a8a8a;
            font-weight: 700;
        }
    </style>
</head>

<body>
    <div class="wrap">
        <div class="card">
            <h1>MindDiary AI ë°ëª¨</h1>
            <p class="sub">âœ… â€œì§‘ì¤‘ ëª¨ë“œ(í•œ ë‹¨ê³„ì”©)â€ / â€œì „ì²´ ë³´ê¸°â€ë¥¼ í† ê¸€ë¡œ ì„ íƒí•  ìˆ˜ ìˆì–´ìš”.</p>

            <!-- 0) ì¼ê¸° ì…ë ¥ -->
            <div class="title">0) ì˜¤ëŠ˜ì˜ ê¸°ë¡</div>
            <p class="hint">ì¼ê¸°ë¥¼ ì“°ê³  <b>â€œAI ë¶„ì„ ì‹œì‘(ë°ëª¨)â€</b>ì„ ëˆ„ë¥´ë©´ Step ì…ë ¥ íë¦„ì´ ì—´ë¦½ë‹ˆë‹¤.</p>
            <textarea id="diary">ì˜¤ëŠ˜ íšŒì˜ì—ì„œ ë‚´ ì˜ê²¬ì„ ë§í–ˆëŠ”ë° ë°˜ì‘ì´ ì• ë§¤í–ˆë‹¤.
ê·¸ ë’¤ë¡œ ê³„ì† ë‚´ê°€ ë§ì‹¤ìˆ˜í•œ ê±´ ì•„ë‹Œì§€ ìƒê°ì´ ë– ë‚˜ì§€ ì•Šì•˜ë‹¤.
ì§‘ì— ì™€ì„œë„ ë§ˆìŒì´ ë‹µë‹µí•˜ê³ , ìˆ¨ì´ ì–•ì•„ì§€ê³ , ê´œíˆ SNSë§Œ ê³„ì† ë´¤ë‹¤.</textarea>

            <div class="actions">
                <button class="btn ghost" id="resetBtn" type="button">ì´ˆê¸°í™”</button>
                <button class="btn primary" id="demoBtn" type="button">AI ë¶„ì„ ì‹œì‘(ë°ëª¨)</button>
            </div>

            <!-- âœ… ì§„í–‰ ëª¨ë“œ í† ê¸€ -->
            <div class="modeBar" id="modeBar" hidden>
                <div class="modeLeft">
                    <p class="modeTitle">ì§„í–‰ ë°©ì‹</p>
                    <p class="modeDesc">ì§‘ì¤‘ ëª¨ë“œ ONì´ë©´ STEP 1â†’2â†’3 ìˆœì„œë¡œë§Œ ë³´ì—¬ìš”. OFFë©´ ì „ì²´ë¥¼ í•œ ë²ˆì— í¸ì§‘í•  ìˆ˜ ìˆì–´ìš”.</p>
                </div>
                <div class="switch">
                    <span class="switchLabel" id="modeText">ì§‘ì¤‘ ëª¨ë“œ ON</span>
                    <button class="toggle on" id="modeToggle" type="button" aria-label="toggle">
                        <span class="knob"></span>
                    </button>
                </div>
            </div>

            <!-- ì…ë ¥ íë¦„ -->
            <section class="flow" id="flowArea" hidden>

                <!-- STEP 1 -->
                <div class="step" id="step1">
                    <div class="stepHead">
                        <div class="stepHeadLeft">
                            <span class="badge">STEP 1</span>
                            <div>
                                <p class="stepTitle">ë°˜ë³µ ì‹ í˜¸(ì–¸ì œë¶€í„° / ë¹ˆë„ / ë°˜ë³µìƒí™©)</p>
                                <div class="stepMeta">í›„ë³´ í´ë¦­ â†’ ì…ë ¥ì¹¸ ìë™ ì±„ì›€</div>
                            </div>
                        </div>
                        <button class="stepToggle" type="button" data-toggle="#step1Body">ì ‘ê¸°</button>
                    </div>

                    <div class="stepBody" id="step1Body">
                        <div class="aiQuestion" id="reflectionBox" hidden></div>

                        <div class="grid2">
                            <div class="field">
                                <div class="labelRow">
                                    <div class="label">ì–¸ì œë¶€í„°</div>
                                    <div class="miniHint">ëŒ€ëµìœ¼ë¡œ ì ì–´ë„ OK</div>
                                </div>
                                <input class="input" id="sinceInput" placeholder="ì˜ˆ) íšŒì˜ ì§í›„ë¶€í„°" />
                                <div class="candidatePanel" id="sincePanel" hidden>
                                    <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                    <div class="chips" id="sinceChips"></div>
                                    <div class="addRow">
                                        <input class="input" id="sinceAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ì ì‹¬ ì´í›„ë¶€í„°" />
                                        <button class="smallBtn" type="button" data-add="since">ì¶”ê°€</button>
                                    </div>
                                </div>
                            </div>

                            <div class="field">
                                <div class="labelRow">
                                    <div class="label">ë¹ˆë„</div>
                                    <div class="miniHint">ì •í™•íˆ ëª°ë¼ë„ ë¨</div>
                                </div>
                                <input class="input" id="freqInput" placeholder="ì˜ˆ) ì´ë²ˆ ì£¼ 2~3íšŒ" />
                                <div class="candidatePanel" id="freqPanel" hidden>
                                    <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                    <div class="chips" id="freqChips"></div>
                                    <div class="addRow">
                                        <input class="input" id="freqAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ì£¼ 1íšŒ" />
                                        <button class="smallBtn" type="button" data-add="freq">ì¶”ê°€</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <div class="labelRow">
                                <div class="label">ë°˜ë³µ ìƒí™©</div>
                                <div class="miniHint">íŠ¸ë¦¬ê±°ê°€ ë˜ëŠ” ìˆœê°„</div>
                            </div>
                            <input class="input" id="patternInput" placeholder="ì˜ˆ) íšŒì˜/í”¼ë“œë°± ì§í›„" />
                            <div class="candidatePanel" id="patternPanel" hidden>
                                <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                <div class="chips" id="patternChips"></div>
                                <div class="addRow">
                                    <input class="input" id="patternAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) í˜¼ì ìˆì„ ë•Œ" />
                                    <button class="smallBtn" type="button" data-add="pattern">ì¶”ê°€</button>
                                </div>
                            </div>
                        </div>

                        <div class="warn" id="warn1"></div>

                        <div class="nextBar">
                            <button class="btn ghost" id="next1" type="button">ë‹¤ìŒ(â†’ STEP 2)</button>
                        </div>
                    </div>
                </div>

                <!-- STEP 2 -->
                <div class="step" id="step2">
                    <div class="stepHead">
                        <div class="stepHeadLeft">
                            <span class="badge">STEP 2</span>
                            <div>
                                <p class="stepTitle">ìƒí™© â†’ ëª¸ â†’ ìƒê°</p>
                                <div class="stepMeta">í›„ë³´ í´ë¦­ â†’ ì…ë ¥ì¹¸ ìë™ ì±„ì›€</div>
                            </div>
                        </div>
                        <button class="stepToggle" type="button" data-toggle="#step2Body">ì ‘ê¸°</button>
                    </div>

                    <div class="stepBody" id="step2Body">
                        <div class="grid2">
                            <div class="field">
                                <div class="labelRow">
                                    <div class="label">ìƒí™©</div>
                                    <div class="miniHint">ì–´ë–¤ íŠ¸ë¦¬ê±°?</div>
                                </div>
                                <input class="input" id="situationInput" placeholder="ì˜ˆ) ìƒëŒ€ ë°˜ì‘ì´ ì• ë§¤í–ˆì„ ë•Œ" />
                                <div class="candidatePanel" id="situationPanel" hidden>
                                    <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                    <div class="chips" id="situationChips"></div>
                                    <div class="addRow">
                                        <input class="input" id="situationAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ë‹µì¥ì´ ëŠ¦ì„ ë•Œ" />
                                        <button class="smallBtn" type="button" data-add="situation">ì¶”ê°€</button>
                                    </div>
                                </div>
                            </div>

                            <div class="field">
                                <div class="labelRow">
                                    <div class="label">ëª¸ë°˜ì‘</div>
                                    <div class="miniHint">ëª¸ì—ì„œ ë¨¼ì € ì˜¨ ì‹ í˜¸</div>
                                </div>
                                <input class="input" id="bodyInput" placeholder="ì˜ˆ) ìˆ¨ì´ ì–•ì•„ì§" />
                                <div class="candidatePanel" id="bodyPanel" hidden>
                                    <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                    <div class="chips" id="bodyChips"></div>
                                    <div class="addRow">
                                        <input class="input" id="bodyAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ê°€ìŠ´ ë‹µë‹µí•¨" />
                                        <button class="smallBtn" type="button" data-add="body">ì¶”ê°€</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="field">
                            <div class="labelRow">
                                <div class="label">ìƒê°</div>
                                <div class="miniHint">ë¨¸ë¦¿ì† ìë™ë¬¸ì¥</div>
                            </div>
                            <input class="input" id="thoughtInput" placeholder="ì˜ˆ) ë‚´ê°€ ì´ìƒí•˜ê²Œ ë³´ì˜€ì„ê¹Œ?" />
                            <div class="candidatePanel" id="thoughtPanel" hidden>
                                <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                <div class="chips" id="thoughtChips"></div>
                                <div class="addRow">
                                    <input class="input" id="thoughtAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ë§ì‹¤ìˆ˜í•œ ê²ƒ ê°™ì•„" />
                                    <button class="smallBtn" type="button" data-add="thought">ì¶”ê°€</button>
                                </div>
                            </div>
                        </div>

                        <div class="warn" id="warn2"></div>

                        <div class="nextBar">
                            <button class="btn ghost" id="prev2" type="button">ì´ì „(â† STEP 1)</button>
                            <button class="btn ghost" id="next2" type="button">ë‹¤ìŒ(â†’ STEP 3)</button>
                        </div>
                    </div>
                </div>

                <!-- STEP 3 -->
                <div class="step" id="step3">
                    <div class="stepHead">
                        <div class="stepHeadLeft">
                            <span class="badge">STEP 3</span>
                            <div>
                                <p class="stepTitle">ë‚´ì¼ ì‹¤í—˜(ì‘ê²Œ)</p>
                                <div class="stepMeta">AI íŒíŠ¸ê°€ ìˆìœ¼ë©´ í´ë¦­í•´ì„œ ë„£ê³ , ì—†ìœ¼ë©´ ì§ì ‘ ì‘ì„±</div>
                            </div>
                        </div>
                        <button class="stepToggle" type="button" data-toggle="#step3Body">ì ‘ê¸°</button>
                    </div>

                    <div class="stepBody" id="step3Body">
                        <div class="aiQuestion" id="hintBox" hidden></div>

                        <div class="field">
                            <div class="labelRow">
                                <div class="label">ë‚´ì¼ ì‹¤í—˜(ì‘ê²Œ)</div>
                                <div class="miniHint">1~3ë¶„ì§œë¦¬ ì¶”ì²œ</div>
                            </div>
                            <input class="input" id="tomorrowInput" placeholder="ì˜ˆ) íšŒì˜ ì§í›„ í˜¸í¡ 3ë²ˆ" />
                            <div class="candidatePanel" id="tomorrowPanel" hidden>
                                <div class="candidateTop"><strong>AI í›„ë³´</strong><small>í´ë¦­í•´ì„œ ì ìš©</small></div>
                                <div class="chips" id="tomorrowChips"></div>
                                <div class="addRow">
                                    <input class="input" id="tomorrowAdd" placeholder="í›„ë³´ ì¶”ê°€ ì˜ˆ) ë¬¼ í•œ ì” ë§ˆì‹œê¸°" />
                                    <button class="smallBtn" type="button" data-add="tomorrow">ì¶”ê°€</button>
                                </div>
                            </div>
                        </div>

                        <div class="warn" id="warn3"></div>

                        <div class="actions">
                            <button class="btn ghost" id="fillExampleBtn" type="button">ì˜ˆì‹œ ìë™ ì±„ìš°ê¸°</button>
                            <button class="btn primary" id="showFinalBtn" type="button">ì €ì¥ & ê²°ê³¼ ë³´ê¸°</button>
                        </div>

                        <!-- âœ… ê²°ê³¼ ì¹´ë“œ -->
                        <div class="finalWrap" id="finalExample" hidden>
                            <div class="finalList">
                                <div class="finalCard">
                                    <div class="finalHead">
                                        <span class="iconBox">âœ…</span>
                                        <span>í•˜ë£¨ ê¸°ë¡ ì¹´ë“œ</span>
                                    </div>
                                    <div class="finalBody" id="finalDaily"><span class="placeholder">-</span></div>
                                </div>

                                <div class="finalCard">
                                    <div class="finalHead">
                                        <span class="iconBox">ğŸ”</span>
                                        <span>ë°˜ë³µ ì‹ í˜¸</span>
                                    </div>
                                    <div class="finalBody" id="finalSignals"><span class="placeholder">-</span></div>
                                </div>

                                <div class="finalCard">
                                    <div class="finalHead">
                                        <span class="iconBox">ğŸ§­</span>
                                        <span>ìƒí™© â†’ ëª¸ â†’ ìƒê°</span>
                                    </div>
                                    <div class="finalBody" id="finalFlow"><span class="placeholder">-</span></div>
                                </div>

                                <div class="finalCard">
                                    <div class="finalHead">
                                        <span class="iconBox">ğŸ“š</span>
                                        <span>ê°ì • ì–¸ì–´ ìš”ì•½</span>
                                    </div>
                                    <div class="finalBody" id="finalLit"><span class="placeholder">-</span></div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

            </section>
        </div>
    </div>

    <script>
        const $ = (id) => document.getElementById(id);

        const demoResult = {
            observation_guess: {
                since: ["íšŒì˜ ì§í›„ë¶€í„°", "í‡´ê·¼ê¸¸ë¶€í„°", "ì§‘ì— ì˜¨ ë’¤ë¶€í„°"],
                frequency: ["ì´ë²ˆ ì£¼ 2~3íšŒ", "ê±°ì˜ ë§¤ì¼", "ì˜¤ëœë§Œ(íŠ¹ì • ì‚¬ê±´ í›„)"],
                pattern: ["íšŒì˜/í”¼ë“œë°± ì§í›„", "í˜¼ì ìˆì„ ë•Œ", "SNS ë³¼ ë•Œ"]
            },
            flow_guess: {
                situation: ["íšŒì˜ì—ì„œ ì˜ê²¬ ë§í•œ ì§í›„", "ìƒëŒ€ ë°˜ì‘ì´ ì• ë§¤í–ˆì„ ë•Œ", "ì§‘ì—ì„œ í˜¼ì ìˆì„ ë•Œ"],
                body: ["ê°€ìŠ´ ë‹µë‹µí•¨", "ìˆ¨ì´ ì–•ì•„ì§", "ì–´ê¹¨/í„±ì— í˜ ë“¤ì–´ê°"],
                thought: ["ë§ì‹¤ìˆ˜í•œ ê²ƒ ê°™ì•„", "ë‚´ê°€ ì´ìƒí•˜ê²Œ ë³´ì˜€ì„ê¹Œ?", "ê³„ì† ê³±ì”¹ê²Œ ë¼"]
            },
            reflection_question: "ê°ì •ì´ ì˜¬ë¼ì˜¤ê¸° ì‹œì‘í•œ â€˜ì²« ì‹ í˜¸â€™ëŠ” ëª¸ì—ì„œ ì–´ë””ì˜€ì„ê¹Œ?",
            tomorrow_hint: "íšŒì˜ ì§í›„ 2ë¶„ë§Œ ìë¦¬ì—ì„œ ì¼ì–´ë‚˜ í˜¸í¡ì„ 3ë²ˆ í™•ì¸í•´ë³´ê¸°",
            emotion_language_summary: "ë¶ˆì•ˆ Â· â€œí™•ì‹ ì´ ì—†ì„ ë•Œ ë§ˆìŒì€ ë¯¸ë˜ë¥¼ ëŒ€ì‹  ì‚´ì•„ë²„ë¦°ë‹¤â€ Â· ã€ë…¸ë¥´ì›¨ì´ì˜ ìˆ²ã€"
        };

        // âœ… ì§„í–‰ ëª¨ë“œ ìƒíƒœ: true = ì§‘ì¤‘ ëª¨ë“œ(í•œ ë‹¨ê³„ì”©)
        let focusMode = true;
        let currentStep = 1;

        function escapeHtml(s) {
            return (s || "")
                .replaceAll("&", "&amp;")
                .replaceAll("<", "&lt;")
                .replaceAll(">", "&gt;")
                .replaceAll('"', "&quot;");
        }

        function showBox(id, label, content) {
            const el = $(id);
            if (!content) { el.hidden = true; el.textContent = ""; return; }
            el.hidden = false;
            el.innerHTML = `<b>${escapeHtml(label)}</b> ${escapeHtml(content)}`;
        }

        function renderChips(containerId, items, targetInputId) {
            const box = $(containerId);
            box.innerHTML = "";

            if (!items || !items.length) {
                const empty = document.createElement("div");
                empty.style.color = "#777";
                empty.style.fontSize = "12px";
                empty.textContent = "í›„ë³´ê°€ ì—†ì–´ìš”.";
                box.appendChild(empty);
                return;
            }

            items.slice(0, 5).forEach(text => {
                const chip = document.createElement("button");
                chip.type = "button";
                chip.className = "chip";
                chip.textContent = text;
                chip.addEventListener("click", () => {
                    $(targetInputId).value = text;
                    $(targetInputId).focus();
                });
                box.appendChild(chip);
            });
        }

        function showAI(result) {
            $("flowArea").hidden = false;
            $("modeBar").hidden = false;

            showBox("reflectionBox", "ì˜¤ëŠ˜ì˜ ê´€ì°° ì§ˆë¬¸:", result?.reflection_question);
            showBox("hintBox", "ë‚´ì¼ ì‹¤í—˜ í›„ë³´:", result?.tomorrow_hint);

            const g = result?.observation_guess || {};
            renderChips("sinceChips", g.since || [], "sinceInput");
            renderChips("freqChips", g.frequency || [], "freqInput");
            renderChips("patternChips", g.pattern || [], "patternInput");
            $("sincePanel").hidden = false;
            $("freqPanel").hidden = false;
            $("patternPanel").hidden = false;

            const f = result?.flow_guess || {};
            renderChips("situationChips", f.situation || [], "situationInput");
            renderChips("bodyChips", f.body || [], "bodyInput");
            renderChips("thoughtChips", f.thought || [], "thoughtInput");
            $("situationPanel").hidden = false;
            $("bodyPanel").hidden = false;
            $("thoughtPanel").hidden = false;

            $("tomorrowPanel").hidden = false;
            const tBox = $("tomorrowChips");
            tBox.innerHTML = "";
            if (result?.tomorrow_hint) {
                const chip = document.createElement("button");
                chip.type = "button";
                chip.className = "chip";
                chip.textContent = result.tomorrow_hint;
                chip.addEventListener("click", () => {
                    $("tomorrowInput").value = result.tomorrow_hint;
                    $("tomorrowInput").focus();
                });
                tBox.appendChild(chip);

                if (!$("tomorrowInput").value.trim()) $("tomorrowInput").value = result.tomorrow_hint;
            }

            // ì´ˆê¸° í™”ë©´ ë°˜ì˜
            currentStep = 1;
            applyStepVisibility();
            $("step1").scrollIntoView({ behavior: "smooth", block: "start" });
        }

        // í›„ë³´ ì¶”ê°€ ë²„íŠ¼
        const addMap = {
            since: { addId: "sinceAdd", chipsId: "sinceChips", inputId: "sinceInput" },
            freq: { addId: "freqAdd", chipsId: "freqChips", inputId: "freqInput" },
            pattern: { addId: "patternAdd", chipsId: "patternChips", inputId: "patternInput" },
            situation: { addId: "situationAdd", chipsId: "situationChips", inputId: "situationInput" },
            body: { addId: "bodyAdd", chipsId: "bodyChips", inputId: "bodyInput" },
            thought: { addId: "thoughtAdd", chipsId: "thoughtChips", inputId: "thoughtInput" },
            tomorrow: { addId: "tomorrowAdd", chipsId: "tomorrowChips", inputId: "tomorrowInput" }
        };

        function addCandidate(type) {
            const conf = addMap[type];
            if (!conf) return;

            const v = $(conf.addId).value.trim();
            if (!v) return;

            const box = $(conf.chipsId);
            const exists = Array.from(box.querySelectorAll(".chip")).some(c => c.textContent === v);
            if (!exists) {
                const chip = document.createElement("button");
                chip.type = "button";
                chip.className = "chip";
                chip.textContent = v;
                chip.addEventListener("click", () => {
                    $(conf.inputId).value = v;
                    $(conf.inputId).focus();
                });
                box.appendChild(chip);
            }

            $(conf.inputId).value = v;
            $(conf.addId).value = "";
        }

        document.addEventListener("click", (e) => {
            const btn = e.target.closest("[data-add]");
            if (!btn) return;
            addCandidate(btn.getAttribute("data-add"));
        });

        function fillExampleSelection() {
            $("sinceInput").value = "íšŒì˜ ì§í›„ë¶€í„°";
            $("freqInput").value = "ì´ë²ˆ ì£¼ 2~3íšŒ";
            $("patternInput").value = "íšŒì˜/í”¼ë“œë°± ì§í›„";

            $("situationInput").value = "ìƒëŒ€ ë°˜ì‘ì´ ì• ë§¤í–ˆì„ ë•Œ";
            $("bodyInput").value = "ìˆ¨ì´ ì–•ì•„ì§";
            $("thoughtInput").value = "ë‚´ê°€ ì´ìƒí•˜ê²Œ ë³´ì˜€ì„ê¹Œ?";

            $("tomorrowInput").value = demoResult.tomorrow_hint;

            ["sincePanel", "freqPanel", "patternPanel", "situationPanel", "bodyPanel", "thoughtPanel", "tomorrowPanel"]
                .forEach(id => $(id).hidden = false);
        }

        // âœ… ê²°ê³¼ ì¹´ë“œì— ê°’ ì±„ìš°ê¸°
        function showFinalExample() {
            const tomorrow = $("tomorrowInput").value.trim();
            $("finalDaily").innerHTML = tomorrow ? escapeHtml(tomorrow) : `<span class="placeholder">-</span>`;

            const since = $("sinceInput").value.trim();
            const freq = $("freqInput").value.trim();
            const pattern = $("patternInput").value.trim();

            const situation = $("situationInput").value.trim();
            const body = $("bodyInput").value.trim();
            const thought = $("thoughtInput").value.trim();

            const signals =
                (since || freq || pattern)
                    ? `â€¢ <b>ì–¸ì œë¶€í„°</b>: ${escapeHtml(since || "-")}<br/>
             â€¢ <b>ë¹ˆë„</b>: ${escapeHtml(freq || "-")}<br/>
             â€¢ <b>ë°˜ë³µ ìƒí™©</b>: ${escapeHtml(pattern || "-")}`
                    : `<span class="placeholder">-</span>`;
            $("finalSignals").innerHTML = signals;

            const flow =
                (situation || body || thought)
                    ? `â€¢ <b>ìƒí™©</b>: ${escapeHtml(situation || "-")}<br/>
             â€¢ <b>ëª¸</b>: ${escapeHtml(body || "-")}<br/>
             â€¢ <b>ìƒê°</b>: ${escapeHtml(thought || "-")}`
                    : `<span class="placeholder">-</span>`;
            $("finalFlow").innerHTML = flow;

            $("finalLit").innerHTML = escapeHtml(demoResult.emotion_language_summary || "-");

            $("finalExample").hidden = false;
            $("finalExample").scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function resetAll() {
            $("flowArea").hidden = true;
            $("finalExample").hidden = true;
            $("modeBar").hidden = true;

            [
                "sinceInput", "freqInput", "patternInput",
                "situationInput", "bodyInput", "thoughtInput",
                "tomorrowInput",
                "sinceAdd", "freqAdd", "patternAdd",
                "situationAdd", "bodyAdd", "thoughtAdd", "tomorrowAdd"
            ].forEach(id => { if ($(id)) $(id).value = ""; });

            ["sincePanel", "freqPanel", "patternPanel", "situationPanel", "bodyPanel", "thoughtPanel", "tomorrowPanel"]
                .forEach(id => $(id).hidden = true);

            $("reflectionBox").hidden = true;
            $("hintBox").hidden = true;

            ["warn1", "warn2", "warn3"].forEach(id => {
                $(id).classList.remove("show");
                $(id).textContent = "";
            });

            $("finalDaily").innerHTML = `<span class="placeholder">-</span>`;
            $("finalSignals").innerHTML = `<span class="placeholder">-</span>`;
            $("finalFlow").innerHTML = `<span class="placeholder">-</span>`;
            $("finalLit").innerHTML = `<span class="placeholder">-</span>`;

            focusMode = true;
            currentStep = 1;
            setToggleUI();
            applyStepVisibility();
        }

        // Step ì ‘ê¸°/í¼ì¹˜ê¸°(ìœ ì§€)
        document.addEventListener("click", (e) => {
            const btn = e.target.closest(".stepToggle");
            if (!btn) return;
            const targetSel = btn.getAttribute("data-toggle");
            const target = document.querySelector(targetSel);
            const hidden = target.style.display === "none";
            target.style.display = hidden ? "block" : "none";
            btn.textContent = hidden ? "ì ‘ê¸°" : "í¼ì¹˜ê¸°";
        });

        // =========================
        // âœ… ì§‘ì¤‘ ëª¨ë“œ(í•œ ë‹¨ê³„ì”©) ë¡œì§
        // =========================
        function setToggleUI() {
            const t = $("modeToggle");
            const txt = $("modeText");
            if (focusMode) {
                t.classList.add("on");
                txt.textContent = "ì§‘ì¤‘ ëª¨ë“œ ON";
            } else {
                t.classList.remove("on");
                txt.textContent = "ì „ì²´ ë³´ê¸°";
            }
        }

        function applyStepVisibility() {
            // ì§‘ì¤‘ ëª¨ë“œ: currentStepë§Œ ë…¸ì¶œ
            if (focusMode) {
                $("step1").hidden = currentStep !== 1;
                $("step2").hidden = currentStep !== 2;
                $("step3").hidden = currentStep !== 3;
            } else {
                // ì „ì²´ ë³´ê¸°: ì „ë¶€ ë…¸ì¶œ
                $("step1").hidden = false;
                $("step2").hidden = false;
                $("step3").hidden = false;
            }
        }

        function gotoStep(n) {
            currentStep = n;
            applyStepVisibility();
            const el = $("step" + n);
            if (el) el.scrollIntoView({ behavior: "smooth", block: "start" });
        }

        function showWarn(step, msg) {
            const el = $("warn" + step);
            el.textContent = msg;
            el.classList.add("show");
            el.scrollIntoView({ behavior: "smooth", block: "center" });
        }
        function clearWarn(step) {
            const el = $("warn" + step);
            el.classList.remove("show");
            el.textContent = "";
        }

        // ìµœì†Œ ê²€ì¦(ì›í•˜ë©´ ë” ì—„ê²©/ëŠìŠ¨í•˜ê²Œ ì¡°ì ˆ ê°€ëŠ¥)
        function validateStep(step) {
            if (step === 1) {
                const since = $("sinceInput").value.trim();
                const freq = $("freqInput").value.trim();
                const pattern = $("patternInput").value.trim();

                clearWarn(1);
                return true;
            }
            if (step === 2) {
                const situation = $("situationInput").value.trim();
                const body = $("bodyInput").value.trim();
                const thought = $("thoughtInput").value.trim();
                if (!situation && !body && !thought) {
                    showWarn(2, "STEP 2ì—ì„œ ìµœì†Œ 1ê°œëŠ” ì…ë ¥/ì„ íƒí•´ì¤˜ì•¼ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ìˆì–´ìš”. (ìƒí™©/ëª¸/ìƒê° ì¤‘ ì•„ë¬´ê±°ë‚˜ 1ê°œ)");
                    return false;
                }
                clearWarn(2);
                return true;
            }
            if (step === 3) {
                const tomorrow = $("tomorrowInput").value.trim();

                clearWarn(3);
                return true;
            }
            return true;
        }

        // âœ… ëª¨ë“œ í† ê¸€ í´ë¦­
        $("modeToggle").addEventListener("click", () => {
            focusMode = !focusMode;
            setToggleUI();

            // ì§‘ì¤‘ ëª¨ë“œë¡œ ì¼œë©´, ì§€ê¸ˆ ì–´ëŠ stepì„ ë³´ê³  ìˆì—ˆëŠ”ì§€ ìœ ì§€
            // ì „ì²´ ë³´ê¸°ë¡œ ë„ë©´, ëª¨ë“  step í¼ì¹˜ê¸°
            applyStepVisibility();

            // UX: í† ê¸€ í›„ í˜„ì¬ stepë¡œ ì‚´ì§ ì´ë™
            if (focusMode) gotoStep(currentStep);
        });

        // âœ… ë‹¤ìŒ/ì´ì „ ë²„íŠ¼
        $("next1").addEventListener("click", () => {
            if (!validateStep(1)) return;
            gotoStep(2);
        });
        $("prev2").addEventListener("click", () => gotoStep(1));
        $("next2").addEventListener("click", () => {
            if (!validateStep(2)) return;
            gotoStep(3);
        });

        // âœ… ì €ì¥ & ê²°ê³¼ ë³´ê¸°
        $("showFinalBtn").addEventListener("click", () => {
            // ì§‘ì¤‘ ëª¨ë“œì—ì„œëŠ” Step3 ê²€ì¦, ì „ì²´ ë³´ê¸°ì—ì„œë„ ë™ì¼ ì ìš©
            if (!validateStep(3)) return;
            showFinalExample();
        });

        $("demoBtn").addEventListener("click", () => {
            // ê¸°ë³¸ì€ ì§‘ì¤‘ ëª¨ë“œ ON
            focusMode = true;
            currentStep = 1;
            setToggleUI();
            showAI(demoResult);
        });

        $("fillExampleBtn").addEventListener("click", () => fillExampleSelection());
        $("resetBtn").addEventListener("click", () => resetAll());

        // ì´ˆê¸° í† ê¸€ UI
        setToggleUI();
        applyStepVisibility();
    </script>
</body>

</html>